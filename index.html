<!DOCTYPE html>
<html>

<head>
    <title>Keyboard Invaders</title>
    <style type="text/css">
    * {
        padding: 0;
        margin: 0;
    }

    #viewport {
        display: block;
        width: 100%;
        height: 100%;
    }

    #container {
        position: absolute;
    }

    input[name="game_input"] {
        position: absolute;
        border: 1px solid blue;
        width: 400px;
        height: 100px;
        font-size: 100px;
        bottom: 100px;
        text-align: center;
    }
    </style>
</head>

<body>
    <div id="container">
        <canvas id="viewport" width="1024" height="768" tabindex="1">
            This text is displayed if your browser does not support HTML5 Canvas.
        </canvas>
        <input type="text" name="game_input" autocomplete="off">
    </div>
    <script type="text/javascript">
    var height = window.innerHeight;
    var width = window.innerWidth;
    var input = document.getElementsByTagName('input')[0];
    var leftOffset = (width - 400) / 2 + 'px';
    input.style.setProperty('left', leftOffset);

    function regainFocus() {
        setTimeout(function() {
            input.focus()
        }, 100);
    }

    function checkMatch(text) {
        if (text === "test") {
            player.fire();
        }
    }
    input.onblur = function(e) {
        e.preventDefault();
        regainFocus();
    }
    input.onchange = function(e) {
        e.preventDefault();
        checkMatch(input.value.trim());
        input.value = "";
        regainFocus();
    }
    window.onkeydown = function(e) {
        switch (e.keyCode) {
            case 37:
                console.log('left');
                break;
            case 38:
                console.log('up');
                break;
            case 39:
                console.log('right');
                break;
            case 40:
                console.log('down');
                break;
                // default:
                //     console.log(e.keyCode);
        }
    }

    regainFocus();

    var context = document
        .getElementById('viewport')
        .getContext('2d');

    var height = window.innerHeight;
    var width = window.innerWidth;

    var gameObjects = [];
    var player;

    var Block = function(options) {
        this.position = {
            x: options.x || 0,
            y: options.y || 0,
        };
        this.size = options.size || 100;
        this.type = options.type || 'enemy';
        this.colour = options.colour || 'red';
    };

    Block.prototype.draw = function(context) {
        context.fillStyle = this.colour;
        context.fillRect(this.position.x, this.position.y, this.size, this.size);
    }

    Block.prototype.update = function() {
        if (this.type === "enemy") {
            this.position.y += 0.2;
        } else if (this.type === "player") {
            this.position.x += 1;
        } else if (this.type === "bullet") {
            this.position.y -= 1;
        }
    };

    Block.prototype.fire = function() {
        if (this.type === "player") {
            gameObjects.push(new Block({
                x: this.position.x + this.size / 2,
                y: this.position.y + this.size / 2,
                type: 'bullet',
                size: 25
            }));
        }
    };

    Block.prototype.getBoundingBox = function() {
        return {
            minX: this.position.x,
            minY: this.position.y,
            maxX: this.position.x + this.size,
            maxY: this.position.y + this.size,
        };
    };

    function initialize() {
        player = new Block({
            x: 100,
            y: 450,
            type: 'player',
            colour: 'blue',
        });
        gameObjects.push(new Block({
            x: 100,
            y: 0
        }));
        gameObjects.push(new Block({
            x: 300,
            y: 0
        }));

    }

    function isColliding(bullet, enemy) {
    	var boxA = bullet.getBoundingBox();
    	var boxB = bullet.getBoundingBox();
    	debugger;
        return false;

    }

    function checkCollision() {
        var bullets = gameObjects.filter(function(item) {
            return item.type === 'bullet';
        });

        var enemies = gameObjects.filter(function(item) {
            return item.type === 'enemy';
        });

        bullets.forEach(function(bullet) {
            enemies.forEach(function(enemy) {
                if (isColliding(bullet, enemy)) {

                }
            });
        });
    }

    function gameloop() {
        requestAnimationFrame(gameloop);
        context.clearRect(0, 0, width, height);

        checkCollision();

        player.update();
        player.draw(context);

        gameObjects.forEach(function(item, index) {
            item.update()
            item.draw(context);
        });
    }

    initialize();
    gameloop();
    </script>
</body>

</html>